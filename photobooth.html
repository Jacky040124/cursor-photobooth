<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-1063NJS02R"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'G-1063NJS02R');
    </script>

    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>May I meet you - Cursor Edition</title>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Experience dating through a retro lens. Snap a polaroid, pin it to the 'May I meet you' board, and connect with others in a unique, nostalgic way."
    />
    <meta
      name="keywords"
      content="retro camera, polaroid, instant camera, photo collage, interactive camera, web camera, photography"
    />
    <meta
      name="author"
      content="May I meet you"
    />

    <!-- Open Graph / Facebook -->
    <meta
      property="og:type"
      content="website"
    />
    <meta
      property="og:url"
      content="https://www.mayimeetyou.online/"
    />
    <meta
      property="og:title"
      content="May I meet you - where you meet the lovely people out there"
    />
    <meta
      property="og:description"
      content="Experience dating through a retro lens. Snap a polaroid, pin it to the 'May I meet you' board, and connect with others in a unique, nostalgic way."
    />
    <meta
      property="og:image"
      content="https://image.social/get?url=bubbbly.com/app/retro-camera.html"
    />

    <!-- Twitter -->
    <meta
      property="twitter:card"
      content="summary_large_image"
    />
    <meta
      property="twitter:url"
      content="https://www.mayimeetyou.online/"
    />
    <meta
      property="twitter:title"
      content="May I meet you - where you meet the lovely people out there"
    />
    <meta
      property="twitter:description"
      content="Experience dating through a retro lens. Snap a polaroid, pin it to the 'May I meet you' board, and connect with others in a unique, nostalgic way."
    />
    <meta
      property="twitter:image"
      content="https://image.social/get?url=bubbbly.com/app/retro-camera.html"
    />

    <!-- Favicons -->
    <link
      rel="icon"
      type="image/x-icon"
      href="https://www.mayimeetyou.online/favicon.ico"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://www.mayimeetyou.online/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://www.mayimeetyou.online/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="https://www.mayimeetyou.online/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="https://www.mayimeetyou.online/favicon-192x192.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="https://www.mayimeetyou.online/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://www.mayimeetyou.online/apple-icon-180x180.png"
    />
    <meta
      itemprop="image"
      content="https://www.mayimeetyou.online/favicon-192x192.png"
    />

    <!-- Theme Colors -->
    <meta
      name="theme-color"
      content="#f4f4f5"
    />
    <meta
      name="msapplication-TileColor"
      content="#f4f4f5"
    />
    <meta
      name="msapplication-TileImage"
      content="https://www.mayimeetyou.online/ms-icon-144x144.png"
    />

    <!-- Web App Manifest -->
    <link
      rel="manifest"
      href="/manifest.json"
    />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="https://www.mayimeetyou.online/"
    />

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      /* IMPORT FONTS: Inter (UI), JetBrains Mono (Code/Tech), Permanent Marker (Polaroid) */
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&family=Permanent+Marker&display=swap');

      :root {
        /* LIGHT TONE */
        --bg-color: #f4f4f5;
        --dots-color: #e4e4e7;
        --panel-bg: #ffffff;
        --border-color: #e4e4e7;
        --text-primary: #18181b;
        --text-secondary: #71717a;
        --accent: #3b82f6; /* Cursor Blue-ish */
        --accent-hover: #2563eb;
        --danger: #ef4444;
        --success: #22c55e;
        
        --font-ui: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        --font-mono: 'JetBrains Mono', monospace;
        --font-hand: 'Permanent Marker', cursive;
      }

      * {
        box-sizing: border-box;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        background-image: radial-gradient(var(--dots-color) 1px, transparent 1px);
        background-size: 24px 24px;
        height: 100vh;
        width: 100vw;
        font-family: var(--font-ui);
        color: var(--text-primary);
        overflow: hidden;
        display: flex;
        flex-direction: row;
        user-select: none;
        touch-action: none;
      }

      /* --- Left Pane: Camera Zone --- */
      .camera-zone {
        flex: 0 0 450px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        z-index: 20;
        padding: 40px;
        background: linear-gradient(to right, rgba(255,255,255,0.8), rgba(255,255,255,0));
        border-right: 1px solid transparent;
      }

      .camera-wrapper {
        position: relative;
        width: 100%;
        max-width: 400px;
        aspect-ratio: 1 / 1;
      }

      /* The retro camera image */
      .camera-img {
        width: 100%;
        height: auto;
        position: relative;
        z-index: 20;
        pointer-events: none;
        filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.2));
      }

      .lens-wrapper {
        position: absolute;
        bottom: 35%;
        left: 62%;
        transform: translateX(-50%);
        width: 26%;
        height: 26%;
        border-radius: 50%;
        overflow: hidden;
        z-index: 25;
        background: #000;
        box-shadow: inset 0 0 20px #000;
        border: 2px solid #333;
      }

      video#cam-feed {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1);
        opacity: 0.9;
        filter: contrast(1.1) saturate(1.1);
      }

      .lens-shine {
        position: absolute;
        top: 15%;
        left: 15%;
        width: 30%;
        height: 20%;
        background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.1));
        transform: rotate(-45deg);
        filter: blur(4px);
        z-index: 26;
        pointer-events: none;
      }

      /* Shutter Button Overlay */
      .shutter-btn {
        position: absolute;
        bottom: 42%;
        left: 18%;
        width: 11%;
        height: 11%;
        border-radius: 50%;
        z-index: 30;
        cursor: pointer;
        background: rgba(255, 0, 0, 0.0); 
      }
      
      .shutter-btn::after {
        content: '';
        position: absolute;
        inset: -5px;
        border-radius: 50%;
        border: 2px solid var(--accent);
        opacity: 0;
        transition: opacity 0.2s, transform 0.2s;
        transform: scale(0.9);
      }
      .shutter-btn:hover::after {
        opacity: 1;
        transform: scale(1);
      }

      .ejection-slot {
        position: absolute;
        z-index: 15;
        top: -40%;
        left: 50%;
        transform: translateX(-50%);
        width: 35%;
        height: 100%;
        pointer-events: none;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 20%;
      }

      /* --- Right Pane: Desk Zone --- */
      .desk-zone {
        flex: 1;
        position: relative;
        height: 100%;
        background: radial-gradient(circle at center, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
      }

      /* --- Top Toolbar (Buttons) --- */
      .btn-container {
        position: absolute;
        top: 24px;
        right: 24px;
        z-index: 200;
        display: flex;
        gap: 12px;
      }

      /* --- Twitter Link --- */
      .twitter-link {
        position: absolute;
        left: 24px;
        z-index: 200;
        background: var(--panel-bg);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 8px 14px;
        border-radius: 6px;
        font-family: var(--font-mono);
        font-size: 12px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }

      .twitter-link:hover {
        background: var(--border-color);
        color: var(--text-primary);
        border-color: var(--text-secondary);
      }

      .twitter-text-short { display: none; }
      .twitter-text-full { display: inline; }

      /* --- Action Buttons --- */
      .action-btn {
        background: var(--panel-bg);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 8px 16px;
        border-radius: 6px;
        font-family: var(--font-mono);
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }

      .action-btn:hover {
        background: var(--border-color);
        border-color: var(--text-secondary);
        transform: translateY(-1px);
      }

      .action-btn:active {
        transform: translateY(0);
      }

      #download-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }
      
      #reset-btn:hover {
        border-color: var(--danger);
        color: var(--danger);
      }

      /* --- Polaroid Styling --- */
      .polaroid {
        width: 180px;
        position: absolute;
        cursor: grab;
        pointer-events: auto;
        transform-origin: center center;
        touch-action: none;
        transition: opacity 0.5s ease-out, transform 0.2s;
        perspective: 1000px;
      }

      .polaroid-inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transform-style: preserve-3d;
      }

      .polaroid.flipped .polaroid-inner {
        transform: rotateY(180deg);
      }

      .polaroid-front,
      .polaroid-back {
        position: relative;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        background: #fbfbfb;
        padding: 12px 12px 60px 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        border-radius: 2px;
      }

      .polaroid-back {
        position: absolute;
        top: 0;
        left: 0;
        transform: rotateY(180deg);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background: #fbfbfb;
        border: none;
        color: #222;
      }

      .polaroid:active .polaroid-front,
      .polaroid:active .polaroid-back {
        box-shadow: 0 25px 50px rgba(0,0,0,0.2);
      }

      .polaroid:active {
        z-index: 10000 !important;
      }

      .polaroid img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: #111;
        border: 1px solid rgba(0,0,0,0.1);
        pointer-events: none;
        display: block;
        filter: blur(0) grayscale(0) brightness(1);
        will-change: filter;
      }

      .polaroid.developing-start img {
        filter: blur(20px) grayscale(1) brightness(0.1);
      }

      .polaroid.developing-slow img {
        transition: filter 6s ease-in-out;
        filter: blur(0) grayscale(0) brightness(1);
      }

      .polaroid.developing-fast img {
        transition: filter 3s ease-out !important;
        filter: blur(0) grayscale(0) brightness(1);
      }

      .polaroid .caption-main {
        position: absolute;
        bottom: 24px;
        left: 12px;
        width: 156px;
        text-align: center;
        color: #18181b;
        opacity: 0.9;
        cursor: text;
        font-family: var(--font-hand);
        font-size: 16px;
        line-height: 1.2;
        min-height: 20px;
        background: transparent;
        border: none;
      }
      
      .polaroid .caption-main:focus {
        background: rgba(0,0,0,0.05);
        border-radius: 4px;
      }

      .polaroid .caption-main:empty::before {
        content: 'May I meet you';
        opacity: 0.4;
      }

      .polaroid .caption-date {
        position: absolute;
        bottom: 8px;
        left: 12px;
        width: 156px;
        text-align: center;
        font-family: var(--font-hand);
        font-size: 10px;
        color: #71717a;
        pointer-events: none;
        user-select: none;
      }

      .polaroid.ejecting {
        transform: translateY(100%);
        animation: riseOut 2s cubic-bezier(0.23, 1, 0.32, 1) forwards;
      }

      @keyframes riseOut {
        0% { transform: translateY(100%); opacity: 1; }
        100% { transform: translateY(-60px); opacity: 1; }
      }

      .flip-btn {
        position: absolute;
        top: 50%;
        right: -18px;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        background: var(--panel-bg);
        border: 1px solid var(--border-color);
        border-radius: 50%;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        z-index: 60;
        color: var(--text-primary);
        transition: all 0.2s;
        opacity: 0;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }

      .polaroid.can-share .flip-btn { display: flex; }
      .polaroid.can-share:hover .flip-btn { opacity: 1; pointer-events: auto; }
      .polaroid.can-share.flipped:hover .flip-btn { opacity: 1; pointer-events: auto; }

      .flip-btn:hover {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
        transform: translateY(-50%) scale(1.1);
      }

      /* Action Buttons on Polaroid */
      .polaroid-actions {
          position: absolute;
          top: -35px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          flex-direction: column;
          gap: 4px;
          align-items: center;
          z-index: 50;
          pointer-events: none;
          opacity: 0;
          transition: opacity 0.2s;
      }
      
      .polaroid.can-share:hover .polaroid-actions {
          opacity: 1;
          pointer-events: auto;
      }

      .polaroid-share-btn, .polaroid-email-btn {
        background: var(--accent);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 20px;
        font-family: var(--font-ui);
        font-weight: 500;
        font-size: 11px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        white-space: nowrap;
        transition: all 0.2s;
      }

      .polaroid-share-btn:hover, .polaroid-email-btn:hover {
        background: var(--accent-hover);
        transform: translateY(-2px);
      }

      .polaroid-share-btn.uploading {
        background: var(--panel-bg);
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        cursor: not-allowed;
      }

      .polaroid-share-btn.success {
        background: var(--success);
        color: #fff;
      }
      
      .polaroid-email-btn {
          background: var(--panel-bg);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
      }
      .polaroid-email-btn:hover {
          background: var(--border-color);
          color: var(--text-primary);
      }


      .flip-tooltip {
        position: absolute;
        top: 50%;
        left: calc(100% + 15px);
        transform: translateY(-50%);
        background: var(--panel-bg);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        padding: 6px 10px;
        border-radius: 4px;
        font-family: var(--font-ui);
        font-size: 11px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s;
        z-index: 50;
        white-space: nowrap;
      }
      
      .flip-tooltip::before {
        content: '';
        position: absolute;
        top: 50%;
        left: -4px;
        transform: translateY(-50%) rotate(45deg);
        width: 8px;
        height: 8px;
        background: var(--panel-bg);
        border-left: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
      }

      .polaroid.can-share:hover .flip-tooltip {
        opacity: 1;
        transform: translateY(-50%) translateX(5px);
      }

      .polaroid.flipped .flip-tooltip { display: none !important; }
      .polaroid.flipped .polaroid-front .flip-btn { display: none !important; }
      .polaroid:not(.flipped) .polaroid-back .flip-btn { display: none !important; }

      .flash {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: white;
        opacity: 0;
        pointer-events: none;
        z-index: 10000;
        transition: opacity 0.1s;
      }
      .flash-active { opacity: 0.8; }

      .bottom-nav {
        position: fixed;
        bottom: 24px;
        left: 24px;
        right: 24px;
        z-index: 150;
        display: flex;
        justify-content: space-between;
        align-items: center;
        pointer-events: none;
      }
      .bottom-nav > * { pointer-events: auto; }

      .pin-board {
        position: relative;
        background: rgba(255,255,255,0.8);
        backdrop-filter: blur(8px);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px 16px;
        text-decoration: none;
        transition: all 0.2s ease;
        color: var(--text-primary);
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      }

      .pin-board:hover {
        background: var(--panel-bg);
        border-color: var(--accent);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        transform: translateY(-2px);
      }

      .pin-board-content {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: var(--font-mono);
        font-size: 12px;
      }

      .pin-board-content::before {
        content: 'üìå';
        font-size: 14px;
      }

      .once-link {
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--text-secondary);
        text-decoration: none;
        transition: color 0.2s;
        text-align: right;
        opacity: 0.7;
      }
      .once-link:hover { color: var(--text-primary); opacity: 1; }

      /* --- Modals --- */
      .confirm-modal, .pin-board-modal {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(4px);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .confirm-modal.open, .pin-board-modal.open { display: flex; }

      .confirm-modal-content {
        background: #ffffff;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px;
        max-width: 420px;
        width: 100%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
        color: var(--text-primary);
      }

      .confirm-modal-icon { font-size: 32px; margin-bottom: 16px; }

      .confirm-modal-title {
        font-family: var(--font-ui);
        font-weight: 600;
        font-size: 18px;
        margin: 0 0 12px 0;
        color: var(--text-primary);
      }

      .confirm-modal-message {
        font-family: var(--font-ui);
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.5;
        margin-bottom: 24px;
      }

      .confirm-modal-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .confirm-btn {
        font-family: var(--font-ui);
        font-weight: 500;
        font-size: 13px;
        padding: 10px 20px;
        border-radius: 6px;
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 100px;
      }

      .confirm-btn-yes {
        background: var(--accent);
        color: white;
      }
      .confirm-btn-yes:hover { background: var(--accent-hover); }

      .confirm-btn-no {
        background: transparent;
        border-color: var(--border-color);
        color: var(--text-primary);
      }
      .confirm-btn-no:hover { background: var(--border-color); }

      /* Gallery Modal */
      .pin-board-modal-content {
        background: #ffffff;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px;
        max-width: 90%;
        width: 100%;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        position: relative;
      }

      .pin-board-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
      }

      .pin-board-modal-title {
        font-family: var(--font-ui);
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .pin-board-modal-close {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        width: 32px; height: 32px;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }
      .pin-board-modal-close:hover {
        color: var(--text-primary);
        border-color: var(--text-primary);
      }

      .pin-board-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 10px;
        overflow-y: auto;
        flex: 1;
        align-content: flex-start;
        justify-content: center;
      }
      
      .gallery-item {
        width: 160px;
        background: #fbfbfb;
        padding: 10px 10px 40px 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transition: transform 0.2s;
        position: relative;
        border-radius: 2px;
        flex-shrink: 0;
      }
      .gallery-item:hover {
          transform: scale(1.05);
          z-index: 10;
          box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      }
      .gallery-item img {
          width: 100%;
          height: 140px;
          object-fit: cover;
          background: #eee;
          border: 1px solid rgba(0,0,0,0.05);
      }
      .gallery-caption {
          position: absolute;
          bottom: 12px;
          left: 10px;
          right: 10px;
          text-align: center;
          font-family: var(--font-hand);
          font-size: 11px;
          color: #333;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      /* Email Modal */
      .email-modal {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(4px);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .email-modal.open { display: flex; }

      .email-modal-content {
        background: #ffffff;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px;
        max-width: 420px;
        width: 100%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
        color: var(--text-primary);
      }

      .email-modal-icon { font-size: 40px; margin-bottom: 16px; }

      .email-modal-title {
        font-family: var(--font-ui);
        font-weight: 600;
        font-size: 18px;
        margin: 0 0 12px 0;
        color: var(--text-primary);
      }

      .email-modal-message {
        font-family: var(--font-ui);
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.5;
        margin-bottom: 20px;
      }

      .email-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .email-input {
        width: 100%;
        padding: 12px 16px;
        font-family: var(--font-ui);
        font-size: 14px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-color);
        color: var(--text-primary);
        transition: all 0.2s;
        box-sizing: border-box;
      }

      .email-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .email-input::placeholder {
        color: var(--text-secondary);
        opacity: 0.6;
      }

      .email-modal-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .email-btn {
        font-family: var(--font-ui);
        font-weight: 500;
        font-size: 13px;
        padding: 10px 24px;
        border-radius: 6px;
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 100px;
      }

      .email-btn-send {
        background: var(--accent);
        color: white;
      }
      .email-btn-send:hover:not(:disabled) { background: var(--accent-hover); }
      .email-btn-send:disabled {
        background: var(--border-color);
        color: var(--text-secondary);
        cursor: not-allowed;
      }

      .email-btn-cancel {
        background: transparent;
        border-color: var(--border-color);
        color: var(--text-primary);
      }
      .email-btn-cancel:hover { background: var(--border-color); }

      .email-status {
        margin-top: 16px;
        font-family: var(--font-ui);
        font-size: 13px;
        min-height: 20px;
      }

      .email-status.success {
        color: var(--success);
      }

      .email-status.error {
        color: var(--danger);
      }

      @media (max-width: 768px) {
        body { flex-direction: column; }
        .camera-zone {
          flex: 0 0 auto;
          width: 100%;
          height: auto;
          padding: 60px 20px 30px 20px;
          background: linear-gradient(to bottom, rgba(255,255,255,1), rgba(255,255,255,0));
        }
        .desk-zone { width: 100%; height: 100%; }
        .twitter-link { top: 10px; left: 10px; padding: 6px 10px; }
        .github-link { top: 10px; left: 140px !important; padding: 6px 10px; }
        .btn-container { top: 10px; right: 10px; }
        .polaroid { width: 150px; }
        .polaroid img { height: 150px; }
      }
    </style>
  </head>
  <body>
    <a
      href="https://x.com/JackyZhong0124"
      target="_blank"
      rel="noopener noreferrer"
      class="twitter-link"
      title="Follow me on X"
      style="top: 24px;"
    >
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      <span class="twitter-text-full">@JackyZhong0124</span>
      <span class="twitter-text-short">@JackyZhong0124</span>
    </a>

    <a
      href="https://github.com/jackyzhong0124/cursor-photobooth"
      target="_blank"
      rel="noopener noreferrer"
      class="twitter-link github-link"
      title="View on GitHub"
      style="top: 64px;"
    >
       <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
       <span class="twitter-text-full">GitHub</span>
       <span class="twitter-text-short">GH</span>
    </a>

    <div class="btn-container">
      <button class="action-btn" id="download-btn" title="Download Collage">Download</button>
      <button class="action-btn" id="reset-btn" title="Clear all photos">Reset</button>
    </div>

    <div class="camera-zone">
      <div class="camera-wrapper">
        <div class="ejection-slot" id="slot"></div>
        <div class="lens-wrapper">
          <video id="cam-feed" autoplay playsinline muted></video>
          <div class="lens-shine"></div>
        </div>
        <img src="https://www.mayimeetyou.online/retro-camera.webp" class="camera-img" alt="Retro Camera" />
        <div class="shutter-btn" id="shutter"></div>
      </div>
    </div>

    <div class="desk-zone" id="desk"></div>
    <div class="flash" id="flash"></div>
    <canvas id="canvas" style="display: none"></canvas>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <a href="#" class="pin-board" id="pin-board-trigger">
        <div class="pin-board-content">
          <div>View Gallery</div>
        </div>
      </a>
      <a href="https://once.film/" target="_blank" rel="noopener noreferrer" class="once-link">
        Captured via Once<br /><span style="opacity:0.6; font-size:10px;">The retro way</span>
      </a>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirm-modal">
      <div class="confirm-modal-content">
        <div class="confirm-modal-icon">üåç</div>
        <h3 class="confirm-modal-title">Publish to Gallery?</h3>
        <p class="confirm-modal-message">This photo will be visible to everyone who visits the gallery.</p>
        <div class="confirm-modal-buttons">
          <button class="confirm-btn confirm-btn-no" id="confirm-no">Cancel</button>
          <button class="confirm-btn confirm-btn-yes" id="confirm-yes">Publish</button>
        </div>
      </div>
    </div>

    <!-- Gallery Modal -->
    <div class="pin-board-modal" id="pin-board-modal">
      <div class="pin-board-modal-content">
        <div class="pin-board-modal-header">
          <h3 class="pin-board-modal-title">Gallery</h3>
          <button class="pin-board-modal-close" id="gallery-close">√ó</button>
        </div>
        <div class="pin-board-gallery" id="gallery-grid">
          <!-- Photos will go here -->
          <div style="width:100%; text-align:center; padding:40px; color:#999;">Loading gallery...</div>
        </div>
      </div>
    </div>

    <!-- Email Modal -->
    <div class="email-modal" id="email-modal">
      <div class="email-modal-content">
        <div class="email-modal-icon">üìß</div>
        <h3 class="email-modal-title">Send Photo to Your Email</h3>
        <p class="email-modal-message">Enter your email address and we'll send you this photo!</p>
        <form id="email-form" class="email-form">
          <input 
            type="email" 
            id="email-input" 
            class="email-input" 
            placeholder="your@email.com" 
            required 
            autocomplete="email"
          />
          <div class="email-modal-buttons">
            <button type="button" class="email-btn email-btn-cancel" id="email-cancel">Cancel</button>
            <button type="submit" class="email-btn email-btn-send" id="email-send">
              <span class="email-btn-text">Send</span>
              <span class="email-btn-loading" style="display:none;">Sending...</span>
            </button>
          </div>
        </form>
        <div class="email-status" id="email-status"></div>
      </div>
    </div>

    <script>
      /* 
         --- SUPABASE CONFIGURATION ---
         Please replace the placeholders below with your actual Supabase Project URL and Anon Key.
         You can find these in your Supabase Dashboard > Project Settings > API.
      */
      const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
      const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
      
      // Initialize Supabase Client
      let supabase;
      try {
          supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      } catch(e) {
          console.error("Supabase setup missing. Please update the SUPABASE_URL and SUPABASE_ANON_KEY in the script.");
      }

      const video = document.getElementById('cam-feed');
      const canvas = document.getElementById('canvas');
      const shutter = document.getElementById('shutter');
      const slot = document.getElementById('slot');
      const flash = document.getElementById('flash');
      const desk = document.getElementById('desk');
      const resetBtn = document.getElementById('reset-btn');
      const downloadBtn = document.getElementById('download-btn');
      const cameraZone = document.querySelector('.camera-zone');
      const btnContainer = document.querySelector('.btn-container');
      const confirmModal = document.getElementById('confirm-modal');
      const confirmYes = document.getElementById('confirm-yes');
      const confirmNo = document.getElementById('confirm-no');
      
      // Gallery Elements
      const galleryTrigger = document.getElementById('pin-board-trigger');
      const galleryModal = document.getElementById('pin-board-modal');
      const galleryClose = document.getElementById('gallery-close');
      const galleryGrid = document.getElementById('gallery-grid');

      // Email Modal Elements
      const emailModal = document.getElementById('email-modal');
      const emailForm = document.getElementById('email-form');
      const emailInput = document.getElementById('email-input');
      const emailCancel = document.getElementById('email-cancel');
      const emailSendBtn = document.getElementById('email-send');
      const emailStatus = document.getElementById('email-status');

      // Email API endpoint (change this if deploying to production)
      const EMAIL_API_URL = 'http://localhost:3001/api/send-email';

      // Current polaroid being emailed
      let pendingEmailPolaroid = null;

      const printSound = new Audio('/polaroid-camera.mp3');
      printSound.volume = 0.6;

      let demosCleared = false;
      let pendingUpload = null;

      function hasConfirmedSharing() {
        return localStorage.getItem('retroCameraShareConfirmed') === 'true';
      }

      function setShareConfirmed() {
        localStorage.setItem('retroCameraShareConfirmed', 'true');
      }

      navigator.mediaDevices
        .getUserMedia({ video: { facingMode: 'user', width: 480, height: 480 } })
        .then((stream) => (video.srcObject = stream))
        .catch((err) => console.error(err));

      function getTodayDateString() {
        const d = new Date();
        return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
      }

      const demoDate = getTodayDateString();
      const demos = [
        { src: '/cat-cute-3.webp', rot: '-5deg', top: '30%', left: '30%' },
        { src: '/cat-cute-2.webp', rot: '8deg', top: '35%', left: '45%' },
        { src: '/cat-cute-1.webp', rot: '-12deg', top: '45%', left: '35%' },
      ];

      function spawnDemos() {
        desk.innerHTML = '';
        demosCleared = false;
        demos.forEach((d) => {
          createPolaroidElement(d.src, demoDate, d.top, d.left, d.rot, true, false);
        });
      }

      spawnDemos();

      function createPolaroidElement(imgSrc, dateStr, top, left, rot, isDemo = false, isNew = false) {
        const MAX_CAPTION_LENGTH = 27;

        const div = document.createElement('div');
        div.className = isDemo ? 'polaroid demo-polaroid' : 'polaroid';
        if (isNew) div.classList.add('developing-start');

        div.innerHTML = `
          <div class="polaroid-inner">
            <div class="polaroid-front">
              <img src="${imgSrc}">
              <div class="polaroid-actions">
                  <button class="polaroid-share-btn">Add to Gallery</button>
                  <button class="polaroid-email-btn" title="Send via Email">Email</button>
              </div>
              <button class="flip-btn" title="Flip to back">‚Üª</button>
              <div class="caption-main" contenteditable="true" spellcheck="false">May I meet you</div>
              <div class="caption-date">${dateStr}</div>
            </div>
          <div class="polaroid-back">
             <div class="polaroid-actions">
                  <button class="polaroid-share-btn">Add to Gallery</button>
                  <button class="polaroid-email-btn" title="Send via Email">Email</button>
              </div>
            <button class="flip-btn" title="Flip to front">‚Üª</button>
          </div>
          </div>
        `;

        if (top) div.style.top = top;
        if (left) div.style.left = left;
        if (rot) div.style.transform = `rotate(${rot})`;

        if (isDemo) {
          desk.appendChild(div);
        } else if (isNew) {
          requestAnimationFrame(() => {
            div.offsetWidth;
            div.classList.add('developing-slow');
            div.classList.remove('developing-start');
          });
        }

        const flipBtns = div.querySelectorAll('.flip-btn');
        flipBtns.forEach(btn => btn.addEventListener('click', (e) => {
            e.stopPropagation();
            div.classList.toggle('flipped');
        }));

        const shareBtns = div.querySelectorAll('.polaroid-share-btn');
        shareBtns.forEach(shareBtn => {
          shareBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            e.preventDefault();
            if (hasConfirmedSharing()) {
              uploadPolaroidImage(div, shareBtn);
            } else {
              pendingUpload = { polaroid: div, button: shareBtn };
              confirmModal.classList.add('open');
            }
          });
        });

        const emailBtns = div.querySelectorAll('.polaroid-email-btn');
        emailBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                // Open email modal and store reference to this polaroid
                pendingEmailPolaroid = div;
                openEmailModal();
            });
        });

        const captionMain = div.querySelector('.caption-main');
        if (captionMain) {
          captionMain.addEventListener('input', function () {
            const text = this.textContent;
            if (text.length > MAX_CAPTION_LENGTH) {
              this.textContent = text.substring(0, MAX_CAPTION_LENGTH);
              const range = document.createRange();
              const sel = window.getSelection();
              range.selectNodeContents(this);
              range.collapse(false);
              sel.removeAllRanges();
              sel.addRange(range);
            }
          });

          captionMain.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') e.preventDefault();
          });
        }

        makeDraggable(div);
        return div;
      }

      function clearDemos() {
        const demoItems = document.querySelectorAll('.demo-polaroid');
        demoItems.forEach((item) => {
          item.style.opacity = '0';
          item.style.transform = 'scale(0.8)';
          setTimeout(() => item.remove(), 500);
        });
      }

      resetBtn.addEventListener('click', () => {
        document.querySelectorAll('.polaroid').forEach((p) => p.remove());
        demosCleared = false;
        desk.innerHTML = '';
        slot.innerHTML = '';
        spawnDemos();
      });

      downloadBtn.addEventListener('click', () => {
        cameraZone.style.display = 'none';
        btnContainer.style.display = 'none';
        document.body.style.backgroundImage = 'none';
        document.body.style.backgroundColor = '#f4f4f5'; // Light bg for screenshot

        html2canvas(document.body, {
          backgroundColor: '#f4f4f5', 
          useCORS: true,
          scale: 2,
        })
          .then((canvas) => {
            const link = document.createElement('a');
            link.download = 'my-polaroid-collage.png';
            link.href = canvas.toDataURL();
            link.click();
            cameraZone.style.display = 'flex';
            btnContainer.style.display = 'flex';
            document.body.style.backgroundImage = '';
            document.body.style.backgroundColor = '';
          })
          .catch((err) => {
            console.error('Screenshot failed', err);
            alert('Could not download image.');
            cameraZone.style.display = 'flex';
            btnContainer.style.display = 'flex';
            document.body.style.backgroundImage = '';
            document.body.style.backgroundColor = '';
          });
      });

      shutter.addEventListener('click', (e) => {
        e.preventDefault();
        if (!demosCleared) {
          clearDemos();
          demosCleared = true;
        }
        flash.classList.add('flash-active');
        setTimeout(() => flash.classList.remove('flash-active'), 100);
        printSound.currentTime = 0;
        printSound.play().catch((e) => {});
        const ctx = canvas.getContext('2d');
        const size = Math.min(video.videoWidth, video.videoHeight);
        canvas.width = 400;
        canvas.height = 400;
        ctx.translate(400, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(video, (video.videoWidth - size) / 2, (video.videoHeight - size) / 2, size, size, 0, 0, 400, 400);
        ejectPhoto(canvas.toDataURL('image/jpeg'));
      });

      function ejectPhoto(src) {
        if (slot.firstChild) slot.removeChild(slot.firstChild);
        const p = createPolaroidElement(src, getTodayDateString(), null, null, null, false, true);
        p.classList.add('ejecting');
        slot.appendChild(p);
      }

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if(confirmModal.classList.contains('open')) closeConfirmModal();
            if(galleryModal.classList.contains('open')) closeGalleryModal();
            if(emailModal.classList.contains('open')) closeEmailModal();
        }
      });

      confirmYes.addEventListener('click', () => {
        setShareConfirmed();
        closeConfirmModal();
        if (pendingUpload) {
          uploadPolaroidImage(pendingUpload.polaroid, pendingUpload.button);
          pendingUpload = null;
        }
      });

      confirmNo.addEventListener('click', () => {
        closeConfirmModal();
        pendingUpload = null;
      });

      confirmModal.addEventListener('click', (e) => {
        if (e.target === confirmModal) {
          closeConfirmModal();
          pendingUpload = null;
        }
      });

      function closeConfirmModal() { confirmModal.classList.remove('open'); }
      
      // Gallery Modal Logic
      galleryTrigger.addEventListener('click', (e) => {
          e.preventDefault();
          galleryModal.classList.add('open');
          fetchGallery();
      });
      
      galleryClose.addEventListener('click', closeGalleryModal);
      galleryModal.addEventListener('click', (e) => {
          if (e.target === galleryModal) closeGalleryModal();
      });
      
      function closeGalleryModal() {
          galleryModal.classList.remove('open');
      }

      async function uploadPolaroidImage(polaroidElement, clickedBtn) {
        if(!supabase) {
            alert("Supabase is not configured! Please edit the code to add your SUPABASE_URL and SUPABASE_ANON_KEY.");
            return;
        }

        const img = polaroidElement.querySelector('img');
        if (!img) return;
        
        // UI Updates
        const allShareBtns = polaroidElement.querySelectorAll('.polaroid-share-btn');
        allShareBtns.forEach(btn => {
            btn.classList.add('uploading');
            btn.textContent = 'Uploading...';
            btn.disabled = true;
        });

        try {
          // 1. Convert Base64/URL to Blob
          const imgSrc = img.src;
          let blob;
          if (imgSrc.startsWith('data:')) {
            const res = await fetch(imgSrc);
            blob = await res.blob();
          } else {
             const res = await fetch(imgSrc); // Might fail with CORS if external
             blob = await res.blob();
          }

          // 2. Upload to Supabase Storage
          const fileName = `polaroids/${Date.now()}_${Math.random().toString(36).substring(7)}.jpg`;
          const { data: uploadData, error: uploadError } = await supabase.storage
            .from('photos')
            .upload(fileName, blob, { contentType: 'image/jpeg' });

          if (uploadError) throw uploadError;

          // 3. Get Public URL
          const { data: { publicUrl } } = supabase.storage.from('photos').getPublicUrl(fileName);
          
          // Store public URL on element for reference
          polaroidElement.dataset.publicUrl = publicUrl;

          // 4. Insert Record into Database
          const caption = polaroidElement.querySelector('.caption-main').innerText.trim();
          
          const { error: dbError } = await supabase.from('gallery').insert([{
              url: publicUrl,
              caption: caption,
              created_at: new Date()
          }]);
          
          if(dbError) throw dbError;

          // Success
          allShareBtns.forEach(btn => {
            btn.classList.remove('uploading');
            btn.classList.add('success');
            btn.textContent = '‚úì Published';
          });

          setTimeout(() => {
             allShareBtns.forEach(btn => {
                btn.classList.remove('success');
                btn.textContent = 'Add to Gallery';
                btn.disabled = false;
             });
          }, 3000);

        } catch (error) {
          console.error('Upload error:', error);
          allShareBtns.forEach(btn => {
             btn.classList.remove('uploading');
             btn.textContent = '‚úó Failed';
          });
          setTimeout(() => {
            allShareBtns.forEach(btn => {
                btn.textContent = 'Add to Gallery';
                btn.disabled = false;
            });
          }, 3000);
          alert("Upload failed: " + error.message);
        }
      }
      
      // Email Modal Functions
      function openEmailModal() {
        emailModal.classList.add('open');
        emailInput.value = '';
        emailStatus.textContent = '';
        emailStatus.className = 'email-status';
        emailSendBtn.disabled = false;
        emailSendBtn.querySelector('.email-btn-text').style.display = 'inline';
        emailSendBtn.querySelector('.email-btn-loading').style.display = 'none';
        setTimeout(() => emailInput.focus(), 100);
      }

      function closeEmailModal() {
        emailModal.classList.remove('open');
        pendingEmailPolaroid = null;
        emailInput.value = '';
        emailStatus.textContent = '';
        emailStatus.className = 'email-status';
      }

      emailCancel.addEventListener('click', closeEmailModal);
      
      emailModal.addEventListener('click', (e) => {
        if (e.target === emailModal) closeEmailModal();
      });

      emailForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!pendingEmailPolaroid) {
          emailStatus.textContent = 'Error: No photo selected';
          emailStatus.className = 'email-status error';
          return;
        }

        const email = emailInput.value.trim();
        if (!email) {
          emailStatus.textContent = 'Please enter your email address';
          emailStatus.className = 'email-status error';
          return;
        }

        // Get photo data
        const img = pendingEmailPolaroid.querySelector('img');
        if (!img) {
          emailStatus.textContent = 'Error: Could not find photo';
          emailStatus.className = 'email-status error';
          return;
        }

        // Get caption
        const captionEl = pendingEmailPolaroid.querySelector('.caption-main');
        const caption = captionEl ? captionEl.innerText.trim() : '';

        // Update UI to loading state
        emailSendBtn.disabled = true;
        emailSendBtn.querySelector('.email-btn-text').style.display = 'none';
        emailSendBtn.querySelector('.email-btn-loading').style.display = 'inline';
        emailStatus.textContent = '';
        emailStatus.className = 'email-status';

        try {
          // Get photo data (base64)
          let photoData = img.src;
          
          // If it's not already base64, we need to convert it
          if (!photoData.startsWith('data:')) {
            // Fetch and convert to base64
            const response = await fetch(photoData);
            const blob = await response.blob();
            photoData = await new Promise((resolve) => {
              const reader = new FileReader();
              reader.onloadend = () => resolve(reader.result);
              reader.readAsDataURL(blob);
            });
          }

          // Send to backend API
          const response = await fetch(EMAIL_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: email,
              photoData: photoData,
              caption: caption
            })
          });

          const result = await response.json();

          if (!response.ok) {
            throw new Error(result.message || 'Failed to send email');
          }

          // Success!
          emailStatus.textContent = '‚úì Email sent! Check your inbox.';
          emailStatus.className = 'email-status success';
          
          // Close modal after a delay
          setTimeout(() => {
            closeEmailModal();
          }, 2000);

        } catch (error) {
          console.error('Email error:', error);
          emailStatus.textContent = error.message || 'Failed to send email. Please try again.';
          emailStatus.className = 'email-status error';
          
          // Reset button
          emailSendBtn.disabled = false;
          emailSendBtn.querySelector('.email-btn-text').style.display = 'inline';
          emailSendBtn.querySelector('.email-btn-loading').style.display = 'none';
        }
      });

      async function fetchGallery() {
          if(!supabase) {
              galleryGrid.innerHTML = '<div style="padding:20px; text-align:center;">Supabase not configured.</div>';
              return;
          }
          
          galleryGrid.innerHTML = '<div style="width:100%; text-align:center; color:#999;">Loading...</div>';
          
          const { data, error } = await supabase
            .from('gallery')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(50);
            
          if(error) {
              galleryGrid.innerHTML = `<div style="color:red;">Error loading gallery: ${error.message}</div>`;
              return;
          }
          
          if(!data || data.length === 0) {
              galleryGrid.innerHTML = '<div style="width:100%; text-align:center; padding:40px; color:#999;">Gallery is empty. Be the first to post!</div>';
              return;
          }
          
          galleryGrid.innerHTML = '';
          data.forEach(item => {
              const div = document.createElement('div');
              div.className = 'gallery-item';
              div.innerHTML = `
                  <img src="${item.url}" loading="lazy" />
                  <div class="gallery-caption">${item.caption || 'Untitled'}</div>
              `;
              galleryGrid.appendChild(div);
          });
      }

      function makeDraggable(elm) {
        let startX = 0, startY = 0, initialLeft = 0, initialTop = 0;

        elm.addEventListener('mousedown', dragStart);
        elm.addEventListener('touchstart', dragStart, { passive: false });

        function dragStart(e) {
          if (
            e.target.closest('.caption-main') ||
            e.target.closest('.polaroid-share-btn') ||
            e.target.closest('.polaroid-email-btn') ||
            e.target.closest('.flip-btn')
          ) return;

          e.preventDefault();

          if (elm.classList.contains('developing-slow')) {
            elm.classList.remove('developing-slow');
            void elm.offsetWidth;
            elm.classList.add('developing-fast');
          }

          if (elm.classList.contains('ejecting')) {
            const rect = elm.getBoundingClientRect();
            elm.classList.remove('ejecting');
            document.body.appendChild(elm);
            elm.style.position = 'absolute';
            elm.style.left = rect.left + 'px';
            elm.style.top = rect.top + 'px';
            elm.style.transform = 'rotate(0deg)';
          } else if (elm.parentNode !== document.body) {
            const rect = elm.getBoundingClientRect();
            document.body.appendChild(elm);
            elm.style.left = rect.left + 'px';
            elm.style.top = rect.top + 'px';
          }

          elm.style.zIndex = 10000;
          
          if (e.type === 'touchstart') {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
          } else {
            startX = e.clientX;
            startY = e.clientY;
          }
          initialLeft = elm.offsetLeft;
          initialTop = elm.offsetTop;

          document.addEventListener('mouseup', dragEnd);
          document.addEventListener('mousemove', dragMove);
          document.addEventListener('touchend', dragEnd);
          document.addEventListener('touchmove', dragMove, { passive: false });
        }

        function dragMove(e) {
          e.preventDefault();
          let currentX, currentY;
          if (e.type === 'touchmove') {
            currentX = e.touches[0].clientX;
            currentY = e.touches[0].clientY;
          } else {
            currentX = e.clientX;
            currentY = e.clientY;
          }
          const dx = currentX - startX;
          const dy = currentY - startY;
          elm.style.left = initialLeft + dx + 'px';
          elm.style.top = initialTop + dy + 'px';
          const tilt = Math.max(-8, Math.min(8, dx * 0.1));
          elm.style.transform = `rotate(${tilt}deg) scale(1.05)`;
        }

        function dragEnd() {
          document.removeEventListener('mouseup', dragEnd);
          document.removeEventListener('mousemove', dragMove);
          document.removeEventListener('touchend', dragEnd);
          document.removeEventListener('touchmove', dragMove);
          elm.classList.add('can-share');
          elm.style.zIndex = 'auto';
          const finalRot = (Math.random() * 20 - 10).toFixed(1);
          elm.style.transition = 'transform 0.2s, box-shadow 0.2s';
          elm.style.transform = `rotate(${finalRot}deg) scale(1)`;
          setTimeout(() => {
            elm.style.transition = '';
          }, 200);
        }
      }
    </script>
  </body>
</html>
